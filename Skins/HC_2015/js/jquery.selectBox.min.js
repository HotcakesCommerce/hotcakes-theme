(function(n){var t=this.SelectBox=function(n,t){if(n instanceof jQuery)if(n.length>0)n=n[0];else return;if((this.typeTimer=null,this.typeSearch="",this.isMac=navigator.platform.match(/mac/i),t="object"==typeof t?t:{},this.selectElement=n,!t.mobile&&navigator.userAgent.match(/iPad|iPhone|Android|IEMobile|BlackBerry/i))||"select"!==n.tagName.toLowerCase())return!1;this.init(t)};t.prototype.version="1.2.0";t.prototype.init=function(t){var r=n(this.selectElement),h,e,c,f,o,l;if(r.data("selectBox-control"))return!1;var i=n('<a class="selectBox" />'),a=r.attr("multiple")||parseInt(r.attr("size"))>1,s=t||{},v=parseInt(r.prop("tabindex"))||0,u=this;i.width(r.outerWidth()).addClass(r.attr("class")).attr("title",r.attr("title")||"").attr("tabindex",v).css("display","inline-block").bind("focus.selectBox",function(){(this!==document.activeElement&&document.body!==document.activeElement&&n(document.activeElement).blur(),i.hasClass("selectBox-active"))||(i.addClass("selectBox-active"),r.trigger("focus"))}).bind("blur.selectBox",function(){i.hasClass("selectBox-active")&&(i.removeClass("selectBox-active"),r.trigger("blur"))});n(window).data("selectBox-bindings")||n(window).data("selectBox-bindings",!0).bind("scroll.selectBox",s.hideOnWindowScroll?this.hideMenus:n.noop).bind("resize.selectBox",this.hideMenus);r.attr("disabled")&&i.addClass("selectBox-disabled");r.bind("click.selectBox",function(n){i.focus();n.preventDefault()});a?(t=this.getOptions("inline"),i.append(t).data("selectBox-options",t).addClass("selectBox-inline selectBox-menuShowing").bind("keydown.selectBox",function(n){u.handleKeyDown(n)}).bind("keypress.selectBox",function(n){u.handleKeyPress(n)}).bind("mousedown.selectBox",function(t){1===t.which&&(n(t.target).is("A.selectBox-inline")&&t.preventDefault(),i.hasClass("selectBox-focus")||i.focus())}).insertAfter(r),r[0].style.height||(h=r.attr("size")?parseInt(r.attr("size")):5,e=i.clone().removeAttr("id").css({position:"absolute",top:"-9999em"}).show().appendTo("body"),e.find(".selectBox-options").html("<li><a> <\/a><\/li>"),c=parseInt(e.find(".selectBox-options A:first").html("&nbsp;").outerHeight()),e.remove(),i.height(c*h)),this.disableSelection(i)):(f=n('<span class="selectBox-label" />'),o=n('<span class="selectBox-arrow" />'),f.attr("class",this.getLabelClass()).text(this.getLabelText()),t=this.getOptions("dropdown"),t.appendTo("BODY"),i.data("selectBox-options",t).addClass("selectBox-dropdown").append(f).append(o).bind("mousedown.selectBox",function(n){1===n.which&&(i.hasClass("selectBox-menuShowing")?u.hideMenus():(n.stopPropagation(),t.data("selectBox-down-at-x",n.screenX).data("selectBox-down-at-y",n.screenY),u.showMenu()))}).bind("keydown.selectBox",function(n){u.handleKeyDown(n)}).bind("keypress.selectBox",function(n){u.handleKeyPress(n)}).bind("open.selectBox",function(n,t){t&&t._selectBox===!0||u.showMenu()}).bind("close.selectBox",function(n,t){t&&t._selectBox===!0||u.hideMenus()}).insertAfter(r),l=i.width()-o.outerWidth()-(parseInt(f.css("paddingLeft"))||0)-(parseInt(f.css("paddingRight"))||0),f.width(l),this.disableSelection(i));r.addClass("selectBox").data("selectBox-control",i).data("selectBox-settings",s).hide()};t.prototype.getOptions=function(t){var i,u=n(this.selectElement),r=this,o=function(t,i){return t.children("OPTION, OPTGROUP").each(function(){if(n(this).is("OPTION"))n(this).length>0?r.generateOptions(n(this),i):i.append("<li> <\/li>");else{var t=n('<li class="selectBox-optgroup" />');t.text(n(this).attr("label"));i.append(t);i=o(n(this),i)}}),i},f,e;switch(t){case"inline":return i=n('<ul class="selectBox-options" />'),i=o(u,i),i.find("A").bind("mouseover.selectBox",function(){r.addHover(n(this).parent())}).bind("mouseout.selectBox",function(){r.removeHover(n(this).parent())}).bind("mousedown.selectBox",function(n){1===n.which&&(n.preventDefault(),u.selectBox("control").hasClass("selectBox-active")||u.selectBox("control").focus())}).bind("mouseup.selectBox",function(t){1===t.which&&(r.hideMenus(),r.selectOption(n(this).parent(),t))}),this.disableSelection(i),i;case"dropdown":if(i=n('<ul class="selectBox-dropdown-menu selectBox-options" />'),i=o(u,i),i.data("selectBox-select",u).css("display","none").appendTo("BODY").find("A").bind("mousedown.selectBox",function(t){t.which===1&&(t.preventDefault(),t.screenX===i.data("selectBox-down-at-x")&&t.screenY===i.data("selectBox-down-at-y")&&(i.removeData("selectBox-down-at-x").removeData("selectBox-down-at-y"),/android/i.test(navigator.userAgent.toLowerCase())&&/chrome/i.test(navigator.userAgent.toLowerCase())&&r.selectOption(n(this).parent()),r.hideMenus()))}).bind("mouseup.selectBox",function(t){1===t.which&&(t.screenX!==i.data("selectBox-down-at-x")||t.screenY!==i.data("selectBox-down-at-y"))&&(i.removeData("selectBox-down-at-x").removeData("selectBox-down-at-y"),r.selectOption(n(this).parent()),r.hideMenus())}).bind("mouseover.selectBox",function(){r.addHover(n(this).parent())}).bind("mouseout.selectBox",function(){r.removeHover(n(this).parent())}),f=u.attr("class")||"",""!==f)for(f=f.split(" "),e=0;e<f.length;e++)i.addClass(f[e]+"-selectBox-dropdown-menu");return this.disableSelection(i),i}};t.prototype.getLabelClass=function(){var t=n(this.selectElement).find("OPTION:selected");return("selectBox-label "+(t.attr("class")||"")).replace(/\s+$/,"")};t.prototype.getLabelText=function(){var t=n(this.selectElement).find("OPTION:selected");return t.text()||" "};t.prototype.setLabel=function(){var i=n(this.selectElement),t=i.data("selectBox-control");t&&t.find(".selectBox-label").attr("class",this.getLabelClass()).text(this.getLabelText())};t.prototype.destroy=function(){var i=n(this.selectElement),t=i.data("selectBox-control"),r;t&&(r=t.data("selectBox-options"),r.remove(),t.remove(),i.removeClass("selectBox").removeData("selectBox-control").data("selectBox-control",null).removeData("selectBox-settings").data("selectBox-settings",null).show())};t.prototype.refresh=function(){var u=n(this.selectElement),t=u.data("selectBox-control"),r=t.hasClass("selectBox-dropdown")?"dropdown":"inline",i;t.data("selectBox-options").remove();i=this.getOptions(r);t.data("selectBox-options",i);switch(r){case"inline":t.append(i);break;case"dropdown":this.setLabel();n("BODY").append(i)}"dropdown"===r&&t.hasClass("selectBox-menuShowing")&&this.showMenu()};t.prototype.showMenu=function(){var p=this,s=n(this.selectElement),r=s.data("selectBox-control"),t=s.data("selectBox-settings"),i=r.data("selectBox-options"),e,o,v;if(r.hasClass("selectBox-disabled"))return!1;this.hideMenus();var w=parseInt(r.css("borderBottomWidth"))||0,b=parseInt(r.css("borderTopWidth"))||0,c=r.offset(),k=t.topPositionCorrelation?t.topPositionCorrelation:0,d=t.bottomPositionCorrelation?t.bottomPositionCorrelation:0,g=i.outerHeight(),y=r.outerHeight(),u=parseInt(i.css("max-height")),nt=n(window).scrollTop(),h=c.top-nt,l=n(window).height()-(h+y),f=h>l&&(t.keepInViewport==null?!0:t.keepInViewport),a=f?c.top-g+b+k:c.top+y-w-d;if(h<u&&l<u&&(f?(e=u-(h-5),i.css({"max-height":u-e+"px"}),a=a+e):(e=u-(l-5),i.css({"max-height":u-e+"px"}))),i.data("posTop",f),i.width(r.innerWidth()).css({top:a,left:r.offset().left}).addClass("selectBox-options selectBox-options-"+(f?"top":"bottom")),s.triggerHandler("beforeopen"))return!1;o=function(){s.triggerHandler("open",{_selectBox:!0})};switch(t.menuTransition){case"fade":i.fadeIn(t.menuSpeed,o);break;case"slide":i.slideDown(t.menuSpeed,o);break;default:i.show(t.menuSpeed,o)}t.menuSpeed||o();v=i.find(".selectBox-selected:first");this.keepOptionInView(v,!0);this.addHover(v);r.addClass("selectBox-menuShowing selectBox-menuShowing-"+(f?"top":"bottom"));n(document).bind("mousedown.selectBox",function(t){if(1===t.which){if(n(t.target).parents().andSelf().hasClass("selectBox-options"))return;p.hideMenus()}})};t.prototype.hideMenus=function(){n(".selectBox-dropdown-menu:visible").length!==0&&(n(document).unbind("mousedown.selectBox"),n(".selectBox-dropdown-menu").each(function(){var t=n(this),u=t.data("selectBox-select"),e=u.data("selectBox-control"),i=u.data("selectBox-settings"),f=t.data("posTop"),r;if(u.triggerHandler("beforeclose"))return!1;if(r=function(){u.triggerHandler("close",{_selectBox:!0})},i){switch(i.menuTransition){case"fade":t.fadeOut(i.menuSpeed,r);break;case"slide":t.slideUp(i.menuSpeed,r);break;default:t.hide(i.menuSpeed,r)}i.menuSpeed||r();e.removeClass("selectBox-menuShowing selectBox-menuShowing-"+(f?"top":"bottom"))}else n(this).hide(),n(this).triggerHandler("close",{_selectBox:!0}),n(this).removeClass("selectBox-menuShowing selectBox-menuShowing-"+(f?"top":"bottom"));t.css("max-height","");t.removeClass("selectBox-options-"+(f?"top":"bottom"));t.data("posTop",!1)}))};t.prototype.selectOption=function(t,i){var u=n(this.selectElement),r,s,f,o,e;return(t=n(t),r=u.data("selectBox-control"),s=u.data("selectBox-settings"),r.hasClass("selectBox-disabled"))?!1:0===t.length||t.hasClass("selectBox-disabled")?!1:(u.attr("multiple")?i.shiftKey&&r.data("selectBox-last-selected")?(t.toggleClass("selectBox-selected"),f=t.index()>r.data("selectBox-last-selected").index()?t.siblings().slice(r.data("selectBox-last-selected").index(),t.index()):t.siblings().slice(t.index(),r.data("selectBox-last-selected").index()),f=f.not(".selectBox-optgroup, .selectBox-disabled"),t.hasClass("selectBox-selected")?f.addClass("selectBox-selected"):f.removeClass("selectBox-selected")):this.isMac&&i.metaKey||!this.isMac&&i.ctrlKey?t.toggleClass("selectBox-selected"):(t.siblings().removeClass("selectBox-selected"),t.addClass("selectBox-selected")):(t.siblings().removeClass("selectBox-selected"),t.addClass("selectBox-selected")),r.hasClass("selectBox-dropdown")&&r.find(".selectBox-label").text(t.text()),o=0,e=[],u.attr("multiple")?r.find(".selectBox-selected A").each(function(){e[o++]=n(this).attr("rel")}):e=t.find("A").attr("rel"),r.data("selectBox-last-selected",t),u.val()!==e&&(u.val(e),this.setLabel(),u.trigger("change")),!0)};t.prototype.addHover=function(t){t=n(t);var i=n(this.selectElement),r=i.data("selectBox-control"),u=r.data("selectBox-options");u.find(".selectBox-hover").removeClass("selectBox-hover");t.addClass("selectBox-hover")};t.prototype.getSelectElement=function(){return this.selectElement};t.prototype.removeHover=function(t){t=n(t);var i=n(this.selectElement),r=i.data("selectBox-control"),u=r.data("selectBox-options");u.find(".selectBox-hover").removeClass("selectBox-hover")};t.prototype.keepOptionInView=function(t,i){if(t&&t.length!==0){var o=n(this.selectElement),u=o.data("selectBox-control"),f=u.data("selectBox-options"),r=u.hasClass("selectBox-dropdown")?f:f.parent(),e=parseInt(t.offset().top-r.position().top),s=parseInt(e+t.outerHeight());i?r.scrollTop(t.offset().top-r.offset().top+r.scrollTop()-r.height()/2):(e<0&&r.scrollTop(t.offset().top-r.offset().top+r.scrollTop()),s>r.height()&&r.scrollTop(t.offset().top+t.outerHeight()-r.offset().top+r.scrollTop()-r.height()))}};t.prototype.handleKeyDown=function(t){var s=n(this.selectElement),f=s.data("selectBox-control"),u=f.data("selectBox-options"),h=s.data("selectBox-settings"),e=0,o=0,i,r;if(!f.hasClass("selectBox-disabled"))switch(t.keyCode){case 8:t.preventDefault();this.typeSearch="";break;case 9:case 27:this.hideMenus();this.removeHover();break;case 13:f.hasClass("selectBox-menuShowing")?(this.selectOption(u.find("LI.selectBox-hover:first"),t),f.hasClass("selectBox-dropdown")&&this.hideMenus()):this.showMenu();break;case 38:case 37:if(t.preventDefault(),f.hasClass("selectBox-menuShowing")){for(i=u.find(".selectBox-hover").prev("LI"),e=u.find("LI:not(.selectBox-optgroup)").length,o=0;i.length===0||i.hasClass("selectBox-disabled")||i.hasClass("selectBox-optgroup");)if(i=i.prev("LI"),i.length===0&&(i=h.loopOptions?u.find("LI:last"):u.find("LI:first")),++o>=e)break;this.addHover(i);this.selectOption(i,t);this.keepOptionInView(i)}else this.showMenu();break;case 40:case 39:if(t.preventDefault(),f.hasClass("selectBox-menuShowing")){for(r=u.find(".selectBox-hover").next("LI"),e=u.find("LI:not(.selectBox-optgroup)").length,o=0;0===r.length||r.hasClass("selectBox-disabled")||r.hasClass("selectBox-optgroup");)if(r=r.next("LI"),r.length===0&&(r=h.loopOptions?u.find("LI:first"):u.find("LI:last")),++o>=e)break;this.addHover(r);this.selectOption(r,t);this.keepOptionInView(r)}else this.showMenu()}};t.prototype.handleKeyPress=function(t){var u=n(this.selectElement),r=u.data("selectBox-control"),f=r.data("selectBox-options"),i=this;if(!r.hasClass("selectBox-disabled"))switch(t.keyCode){case 9:case 27:case 13:case 38:case 37:case 40:case 39:break;default:r.hasClass("selectBox-menuShowing")||this.showMenu();t.preventDefault();clearTimeout(this.typeTimer);this.typeSearch+=String.fromCharCode(t.charCode||t.keyCode);f.find("A").each(function(){if(n(this).text().substr(0,i.typeSearch.length).toLowerCase()===i.typeSearch.toLowerCase())return i.addHover(n(this).parent()),i.selectOption(n(this).parent(),t),i.keepOptionInView(n(this).parent()),!1});this.typeTimer=setTimeout(function(){i.typeSearch=""},1e3)}};t.prototype.enable=function(){var i=n(this.selectElement),t;(i.prop("disabled",!1),t=i.data("selectBox-control"),t)&&t.removeClass("selectBox-disabled")};t.prototype.disable=function(){var i=n(this.selectElement),t;(i.prop("disabled",!0),t=i.data("selectBox-control"),t)&&t.addClass("selectBox-disabled")};t.prototype.setValue=function(t){var i=n(this.selectElement),r,u,f;(i.val(t),t=i.val(),null===t&&(t=i.children().first().val(),i.val(t)),r=i.data("selectBox-control"),r)&&(u=i.data("selectBox-settings"),f=r.data("selectBox-options"),this.setLabel(),f.find(".selectBox-selected").removeClass("selectBox-selected"),f.find("A").each(function(){if(typeof t=="object")for(var i=0;i<t.length;i++)n(this).attr("rel")==t[i]&&n(this).parent().addClass("selectBox-selected");else n(this).attr("rel")==t&&n(this).parent().addClass("selectBox-selected")}),u.change&&u.change.call(i))};t.prototype.disableSelection=function(t){n(t).css("MozUserSelect","none").bind("selectstart",function(n){n.preventDefault()})};t.prototype.generateOptions=function(t,i){var r=n("<li />"),u=n("<a />");r.addClass(t.attr("class"));r.data(t.data());u.attr("rel",t.val()).text(t.text());r.append(u);t.attr("disabled")&&r.addClass("selectBox-disabled");t.attr("selected")&&r.addClass("selectBox-selected");i.append(r)};n.extend(n.fn,{setOptions:function(t){var r=n(this),o=r.data("selectBox-control"),i,u,f,e;switch(typeof t){case"string":r.html(t);break;case"object":r.html("");for(i in t)if(t[i]!==null)if(typeof t[i]=="object"){u=n('<optgroup label="'+i+'" />');for(f in t[i])u.append('<option value="'+f+'">'+t[i][f]+"<\/option>");r.append(u)}else e=n('<option value="'+i+'">'+t[i]+"<\/option>"),r.append(e)}o&&n(this).selectBox("refresh")},selectBox:function(i,r){var u;switch(i){case"control":return n(this).data("selectBox-control");case"settings":if(!r)return n(this).data("selectBox-settings");n(this).each(function(){n(this).data("selectBox-settings",n.extend(!0,n(this).data("selectBox-settings"),r))});break;case"options":if(undefined===r)return n(this).data("selectBox-control").data("selectBox-options");n(this).each(function(){n(this).setOptions(r)});break;case"value":if(undefined===r)return n(this).val();n(this).each(function(){(u=n(this).data("selectBox"))&&u.setValue(r)});break;case"refresh":n(this).each(function(){(u=n(this).data("selectBox"))&&u.refresh()});break;case"enable":n(this).each(function(){(u=n(this).data("selectBox"))&&u.enable(this)});break;case"disable":n(this).each(function(){(u=n(this).data("selectBox"))&&u.disable()});break;case"destroy":n(this).each(function(){(u=n(this).data("selectBox"))&&(u.destroy(),n(this).data("selectBox",null))});break;case"instance":return n(this).data("selectBox");default:n(this).each(function(r,u){n(u).data("selectBox")||n(u).data("selectBox",new t(u,i))})}return n(this)}})})(jQuery);
//# sourceMappingURL=jquery.selectBox.min.js.map
