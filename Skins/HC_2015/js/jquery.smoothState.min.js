/*!
 * smoothState.js is jQuery plugin that progressively enhances
 * page loads to behave more like a single-page application.
 *
 * @author  Miguel Ángel Pérez   reachme@miguel-perez.com
 * @see     http://smoothstate.com
 *
 */
(function(n,t,i,r){"use strict";if(!t.history.pushState){n.fn.smoothState=function(){return this};n.fn.smoothState.options={};return}if(!n.fn.smoothState){var e=n("html, body"),f=t.console,o={debug:!1,anchors:"a",hrefRegex:"",forms:"form",allowFormCaching:!1,repeatDelay:500,blacklist:".no-smoothState",prefetch:!1,prefetchOn:"mouseover touchstart",cacheLength:0,loadingClass:"is-loading",scroll:!0,alterRequest:function(n){return n},onBefore:function(){},onStart:{duration:0,render:function(){}},onProgress:{duration:0,render:function(){}},onReady:{duration:0,render:function(n,t){n.html(t)}},onAfter:function(){}},u={isExternal:function(n){var i=n.match(/^([^:\/?#]+:)?(?:\/\/([^\/?#]*))?([^?#]+)?(\?[^#]*)?(#.*)?/);return typeof i[1]=="string"&&i[1].length>0&&i[1].toLowerCase()!==t.location.protocol?!0:typeof i[2]=="string"&&i[2].length>0&&i[2].replace(new RegExp(":("+{"http:":80,"https:":443}[t.location.protocol]+")?$"),"")!==t.location.host?!0:!1},stripHash:function(n){return n.replace(/#.*/,"")},isHash:function(n,i){i=i||t.location.href;var r=n.indexOf("#")>-1?!0:!1,f=u.stripHash(n)===u.stripHash(i)?!0:!1;return r&&f},translate:function(t){var i={dataType:"html",type:"GET"};return typeof t=="string"?n.extend({},i,{url:t}):n.extend({},i,t)},shouldLoadAnchor:function(n,t,i){var f=n.prop("href");return!u.isExternal(f)&&!u.isHash(f)&&!n.is(t)&&!n.prop("target")&&(typeof i===r||i===""||n.prop("href").search(i)!==-1)},clearIfOverCapacity:function(n,t){return Object.keys||(Object.keys=function(n){var t=[];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.push(i);return t}),Object.keys(n).length>t&&(n={}),n},storePageIn:function(t,i,r,u){var f=n("<html><\/html>").append(n(r));return t[i]={status:"loaded",title:f.find("title").first().text(),html:f.find("#"+u),doc:r},t},triggerAllAnimationEndEvent:function(t,i){i=" "+i||"";var r=0,f="allanimationend",e=function(i){n(i.delegateTarget).is(t)&&(i.stopPropagation(),r++)},o=function(i){n(i.delegateTarget).is(t)&&(i.stopPropagation(),r--,r===0&&t.trigger(f))};t.on("animationstart webkitAnimationStart oanimationstart MSAnimationStart",e);t.on("animationend webkitAnimationEnd oanimationend MSAnimationEnd",o);t.on("allanimationend"+i,function(){r=0;u.redraw(t)})},redraw:function(n){n.height()}},s=function(i){if(i.state!==null){var r=t.location.href,e=n("#"+i.state.id),f=e.data("smoothState");f.href===r||u.isHash(r,f.href)||f.load(r,!1)}},h=function(o,s){var h=n(o),l=h.prop("id"),a=null,v=!1,c={},y=t.location.href,p=function(n){n=n||!1;n&&c.hasOwnProperty(n)?delete c[n]:c={};h.data("smoothState").cache=c},w=function(t,i){var r,f;(i=i||n.noop,r=u.translate(t),c=u.clearIfOverCapacity(c,s.cacheLength),c.hasOwnProperty(r.url)&&typeof r.data=="undefined")||(c[r.url]={status:"fetching"},f=n.ajax(r),f.success(function(n){u.storePageIn(c,r.url,n,l);h.data("smoothState").cache=c}),f.error(function(){c[r.url].status="error"}),i&&f.complete(i))},tt=function(){var t,i;a&&(t=n(a,h),t.length&&(i=t.offset().top,e.scrollTop(i)),a=null)},k=function(r){var o="#"+l,u=c[r]?n(c[r].html.html()):null;if(u.length){i.title=c[r].title;h.data("smoothState").href=r;s.loadingClass&&e.removeClass(s.loadingClass);s.onReady.render(h,u);h.one("ss.onReadyEnd",function(){v=!1;s.onAfter(h,u);s.scroll&&tt()});t.setTimeout(function(){h.trigger("ss.onReadyEnd")},s.onReady.duration)}else!u&&s.debug&&f?f.warn("No element with an id of "+o+" in response from "+r+" in "+c):t.location=r},b=function(n,i,r){var o=u.translate(n);typeof i=="undefined"&&(i=!0);typeof r=="undefined"&&(r=!0);var a=!1,v=!1,y={loaded:function(){var n=a?"ss.onProgressEnd":"ss.onStartEnd";if(v&&a)v&&k(o.url);else h.one(n,function(){k(o.url);r||p(o.url)});i&&t.history.pushState({id:l},c[o.url].title,o.url);v&&!r&&p(o.url)},fetching:function(){if(!a){a=!0;h.one("ss.onStartEnd",function(){s.loadingClass&&e.addClass(s.loadingClass);s.onProgress.render(h);t.setTimeout(function(){h.trigger("ss.onProgressEnd");v=!0},s.onProgress.duration)})}t.setTimeout(function(){c.hasOwnProperty(o.url)&&y[c[o.url].status]()},10)},error:function(){s.debug&&f?f.log("There was an error loading: "+o.url):t.location=o.url}};c.hasOwnProperty(o.url)||w(o);s.onStart.render(h);t.setTimeout(function(){s.scroll&&e.scrollTop(0);h.trigger("ss.onStartEnd")},s.onStart.duration);y[c[o.url].status]()},it=function(t){var i,r=n(t.currentTarget);u.shouldLoadAnchor(r,s.blacklist,s.hrefRegex)&&!v&&(t.stopPropagation(),i=u.translate(r.prop("href")),i=s.alterRequest(i),w(i))},rt=function(t){var i=n(t.currentTarget),r;if(!t.metaKey&&!t.ctrlKey&&u.shouldLoadAnchor(i,s.blacklist,s.hrefRegex)&&(t.stopPropagation(),t.preventDefault(),!g())){nt();r=u.translate(i.prop("href"));v=!0;a=i.prop("hash");r=s.alterRequest(r);s.onBefore(i,h);b(r)}},ut=function(t){var u=n(t.currentTarget),i;if(!u.is(s.blacklist)&&(t.preventDefault(),t.stopPropagation(),!g())){nt();i={url:u.prop("action"),data:u.serialize(),type:u.prop("method")};v=!0;i=s.alterRequest(i);i.type.toLowerCase()==="get"&&(i.url=i.url+"?"+i.data);s.onBefore(u,h);b(i,r,s.allowFormCaching)}},d=0,g=function(){var n=s.repeatDelay===null,t=parseInt(Date.now())>d;return!(n||t)},nt=function(){d=parseInt(Date.now())+parseInt(s.repeatDelay)},ft=function(n){if(s.anchors){n.on("click",s.anchors,rt);if(s.prefetch)n.on(s.prefetchOn,s.anchors,it)}if(s.forms)n.on("submit",s.forms,ut)},et=function(){var n=h.prop("class");h.removeClass(n);u.redraw(h);h.addClass(n)};return s=n.extend({},n.fn.smoothState.options,s),t.history.state===null&&t.history.replaceState({id:l},i.title,y),u.storePageIn(c,y,i.documentElement.outerHTML,l),u.triggerAllAnimationEndEvent(h,"ss.onStartEnd ss.onProgressEnd ss.onEndEnd"),ft(h),{href:y,cache:c,clear:p,load:b,fetch:w,restartCSSAnimations:et}},c=function(t){return this.each(function(){var i=this.tagName.toLowerCase();this.id&&i!=="body"&&i!=="html"&&!n.data(this,"smoothState")?n.data(this,"smoothState",new h(this,t)):!this.id&&f?f.warn("Every smoothState container needs an id but the following one does not have one:",this):(i==="body"||i==="html")&&f&&f.warn("The smoothstate container cannot be the "+this.tagName+" tag")})};t.onpopstate=s;n.smoothStateUtility=u;n.fn.smoothState=c;n.fn.smoothState.options=o}})(jQuery,window,document);
//# sourceMappingURL=jquery.smoothState.min.js.map
